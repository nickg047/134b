<!DOCTYPE html>
<html>
<head>
    <title>Virtue / Vice</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../css/list.css">
</head>
<body onload="updateHabitUI();">
    <section>
        <h1>Habit List</h1>
        <ul id="habit-list">
            <li>
		        <div id="HABIT0">
                    <ul class="habit-info">
                        <li><div class="habit-name">Try adding a habit</div></li>
                        <li><img class="habit-icon" src="../img/add.png" alt="add icon"></li>
                    </ul>
                    <div class="message">
                        <span class="message-total">
                            <strong>2</strong> days in a row! Best Record: <strong>5</strong><br>
                            <svg height="25" width="150">
                                <line x1="0" y1="0" x2="60" y2="0" style="stroke:rgba(65, 131, 215, 0.8);stroke-width:25" />
                                <line x1="60" y1="0" x2="150" y2="0" style="stroke:rgba(171,171,171,0.6);stroke-width:25" />
                            </svg>
                        </span><br>
                        <span class="message-today">Completed <strong>1/1</strong> for today!</span>
                    </div>
                    <div class="habit-op">
                        <button type="button" class="op op-done" onclick="showMsg(this);" title="done">
                            <img src="../img/done.svg" alt="Done">
                        </button>
                        <button type="button" class="op op-edit" onclick="location.href='edit.html'" title="edit habit">
                            <img src="../img/edit.svg" alt="Edit">
                        </button>
                        <button type="button" class="op op-del" onclick="deleteHabit(this);" title="delete habit">
                            <img src="../img/delete.svg" alt="Del">
                        </button>
                    </div>
			</div>
            </li>

            <li style="visibility:hidden;">
		        <div id = "HABIT1">
                    <ul class="habit-info">
                        <li><div class="habit-name">Try adding a habit</div></li>
                        <li><img class="habit-icon" src="../img/add.png" alt="add icon"></li>
                    </ul>
                    <div class="message">
                        <span class="message-total">
                            <strong>10</strong> days in a row! Best Record: <strong>20</strong><br>
                            <svg height="25" width="150">
                                <line x1="0" y1="0" x2="75" y2="0" style="stroke:rgba(65, 131, 215, 0.8);stroke-width:25" />
                                <line x1="75" y1="0" x2="150" y2="0" style="stroke:rgba(171,171,171,0.6);stroke-width:25" />
                            </svg>
                        </span><br>
                        <span class="message-today">Completed <strong>1/3</strong> for today!</span>
                    </div>
                    <div class="habit-op">
                        <button type="button" class="op op-done" onclick="showMsg(this);" title="done">
                            <img src="../img/done.svg" alt="Done">
                        </button>
                        <button type="button" class="op op-edit" onclick="location.href='edit.html'" title="edit habit">
                            <img src="../img/edit.svg" alt="Edit">
                        </button>
                        <button type="button" class="op op-del" onclick="deleteHabit(this);" title="delete habit">
                            <img src="../img/delete.svg" alt="Del">
                        </button>
                    </div>
			</div>
            </li>

            <li style = "visibility:hidden;">
		        <div id="HABIT2">
                    <ul class="habit-info">
                        <li><div class="habit-name">Try adding a habit</div></li>
                        <li><img class="habit-icon" src="../img/add.png" alt="add icon"></li>
                    </ul>
                    <div class="message">
                        <span class="message-total">
                            <strong>48</strong> days in a row! Best Record: <strong>60</strong><br>
                            <svg height="25" width="150">
                                <line x1="0" y1="0" x2="120" y2="0" style="stroke:rgba(65, 131, 215, 0.8);stroke-width:25" />
                                <line x1="120" y1="0" x2="150" y2="0" style="stroke:rgba(171,171,171,0.6);stroke-width:25" />
                            </svg>
                        </span><br>
                        <span class="message-today">Completed <strong>1/2</strong> for today!</span>
                    </div>
                    <div class="habit-op">
                        <button type="button" class="op op-done" onclick="showMsg(this);" title="done">
                            <img src="../img/done.svg" alt="Done">
                        </button>
                        <button type="button" class="op op-edit" onclick="location.href='edit.html'" title="edit habit">
                            <img src="../img/edit.svg" alt="Edit">
                        </button>
                        <button type="button" class="op op-del" onclick="deleteHabit(this);" title="delete habit">
                            <img src="../img/delete.svg" alt="Del">
                        </button>
                    </div>
			</div>
            </li>

        </ul>
    </section>

    <button type="button" id="addHabit" onclick="location.href='add.html'" title="add habit">+</button>

    <script type="text/javascript">
    
        //On load update the UI displayed for all habits if allowed
        function updateHabitUI(){
		    var db = localStorage.getItem("Habits");
		    if(db !== null){
		        if(db.indexOf("\"id\":0") !== -1){
			    detailHabit(0);
			}
			if(db.indexOf("\"id\":1") !== -1){
			    detailHabit(1);
			}
		        if(db.indexOf("\"id\":2") !== -1){
			    detailHabit(2);
			}
		    }
		}
				
        //Update the UI for an individual habit using the info from database				
		function detailHabit(habitID){
		    //Get the habit to modify and the database info for it
		    var habitMod = document.getElementById(("HABIT"+habitID));
		    var habitInfo = isolateHabit(habitID);
		    //Title
		    habitMod.getElementsByClassName("habit-name")[0].innerHTML = habitInfo.title;
		    //Image
		    habitMod.getElementsByClassName("habit-icon")[0].src = habitInfo.image;
		    habitMod.getElementsByClassName("habit-name")[0].innerHTML.alt = habitInfo.image.substring(habitInfo.image.lastIndexOf("/")+1);
            
		    //Make it visible
            habitMod.parentNode.style.visibility="visible";
		}
		
		//Isolate the string and make it an object for a desire habit, called by id number
        function isolateHabit(habitID){
            var _mainHabit = localStorage.getItem("Habits");
            if(_mainHabit !== null && typeof habitID == 'number'){
                var _idString = "\"id\":"+habitID;
                var habitString = _mainHabit.substring(_mainHabit.indexOf(_idString) -1);
                habitString = habitString.substring(0, habitString.indexOf("}")+1); 
            }
            return JSON.parse(habitString);
        }	
					
        function showMsg(element){
            var msgElement = (element.parentNode.parentNode.getElementsByClassName("message-today"))[0];
            //alert(msgElement.innerHTML);
            msgElement.style.visibility="visible";
        }

        function deleteHabit(element){
            var child = element.parentNode.parentNode;
            var parent = child.parentNode;
            parent.removeChild(child);


        }
        /*
            only works with backend
            id_param: id of the habit to be deleted
        */
        function deleteHabitLS(id_param){
            var habits = JSON.parse(localStorage.getItem("Habits"));
            var removed = false;
            for (var i = 0; i < habits.length; i++){
                habit = habits[i];
                if(habit.id === id_param) {
                    habits.splice(i, 1);
                    removed = true;
                    break;
                }
            }
            if(removed === true) {
                if(habits.length === 0) {
                    localStorage.removeItem("Habits");
                }
                else {
                    localStorage.setItem("Habits", JSON.stringify(habits));
                }
            }
            else {
                alert("id does not exist");
            }
        }
        function getAllHabits() {
            return JSON.parse(localStorage.getItem("Habits"));
        }
    </script>
</body>
</html>