function onImageClick(a){for(var b=document.getElementsByClassName("icon"),c=0;c<b.length;c++)b[c].style.border="none";image=a,image.style.border="5px solid #42A5F5"}function inputCheck(){var a=document.getElementById("others").value;selectCheckBox(-1),isInt(a)||(document.getElementById("df1").checked=!0)}function updateImage(a){if(!isImageFile(a.files[0].name))return void errorNeedToChooseProperImage();var b=URL.createObjectURL(a.files[0]);"null"!==b?addNewImageChild(b):document.getElementById("icon4".src="../img/add.png")}function isImageFile(a){if(null===a||-1===a.indexOf("."))return!1;var b=a.split(".");return b=b[b.length-1],"jpg"===b||"png"===b?!0:!1}function addNewImageChild(a){var b=document.createElement("img"),c=document.getElementsByClassName("icon").length;b.id="icon"+c,b.className="icon",b.src=a,b.alt="Uploaded Image",b.onclick=function(){onImageClick(this)},document.getElementById("icon-list").appendChild(b),onImageClick(b)}function selectCheckBox(a){1!==a&&(document.getElementById("df1").checked=!1),2!==a&&(document.getElementById("df2").checked=!1),3!==a&&(document.getElementById("df3").checked=!1),-1!==a&&(document.getElementById("others").value="")}function errorChecks(){if(0===document.getElementById("title").value.length)return errorNeedToChooseTitle(),!0;if(document.getElementById("title").value.length>20)return errorNeedToChooseShorterTitle(),!0;if(null===image)return errorNeedToPickImage(),!0;if((!isInt(document.getElementById("others").value)||document.getElementById("others").value<=0)&&document.getElementById("others").value.length>0)return errorNeedProperFrequencyRange(),!0;var a=getDailyCount(),b=getCheckedBoxes("date");return null===a||0===a||0===sumArray(b)?(errorNeedToChooseFrequency(),!0):document.getElementById("others").value>1e3?(errorNeedProperFrequencyRange(),!0):!1}function addFromUI(){if(!errorChecks()){var a=Parse.Object.extend("Habit"),b=location.search.split("id=");if(b.length>=2){b=b[1];var c=new Parse.Query(a);c.get(b,{success:function(a){a=save(a),parseSave(a)},error:function(b,c){var d=save(new a);parseSave(d)}})}else{var d=save(new a);parseSave(d)}}}function parseSave(a){a.save(null,{success:function(a){a=save(a),mixpanel.track("save habit"),location.href="list.html"},error:function(a,b){alert(b.message),mixpanel.track("error in parse save")}})}function save(a){a.set("owner",Parse.User.current().id),a.set("title",document.getElementById("title").value.toString()),a.set("image",getImage()),a.set("weekFreq",getCheckedBoxes("date"));var b=getDailyCount();return a.set("dailyFreq",b),a.get("firstFlurry")||a.set("firstFlurry",!0),a.get("ticks")>b?a.set("ticks",b):a.get("ticks")||a.set("ticks",0),a.get("bestRecord")||a.set("bestRecord",0),a.get("currentStreak")||a.set("currentStreak",0),a.get("dateSuccess")||a.set("dateSuccess",(new Date).toDateString()),a.get("dateAccessed")||a.set("dateAccessed",(new Date).toDateString()),a}function getImage(){var a=image.id.toString().slice(4,5);return parseInt(a)<4?a:getBase64Image()}function getBase64Image(){var a=document.createElement("canvas");a.width=image.width,a.height=image.height;var b=a.getContext("2d");b.drawImage(image,0,0,80,80);var c=a.toDataURL("image/png");return c.replace(/^data:image\/(png|jpg);base64,/,"")}function getDailyCount(){var a=document.getElementById("others").value;if(isInt(a))return parseInt(a,10);for(var b,c=getCheckedBoxes("day"),d=0;d<c.length;d++)if(b=c[d])return d+1;return 0}function isInt(a){return a!=parseInt(a,10)?!1:(a=parseInt(a,10),"number"!=typeof a?!1:!0)}function addHabit(a){if(isAHabit(a)){var b=JSON.parse(localStorage.getItem("Habits"));return null===b&&(b=[]),b.push(a),localStorage.setItem("Habits",JSON.stringify(b)),!0}}function getCheckedBoxes(a){for(var b=document.getElementsByName(a),c=[],d=0;d<b.length;d++)b[d].checked?c.push(1):c.push(0);return c.length>0?c:[1,1,1,1,1,1,1]}function sumArray(a){if(!a)return 0;var b=0,c=a.length,d=0;for(b;c>b;b++)d+=a[b];return d}function isAHabit(a){var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);var d,e=["id","title","image","weekFreq","dailyFreq","other","ticks","bestRecord","currentStreak","date"];for(d=0;d<c.length;d++)if(e[d]!==c[d])return alert("ERROR: Attempted to enter an invalid habit into database"),!1;return!0}function errorNeedToPickImage(){alert("Select an image before saving")}function errorNeedToChooseTitle(){alert("Choose a title before saving"),document.getElementById("title").placeholder="Please Set A Title",document.getElementById("title").className+=" error"}function errorNeedToChooseFrequency(){alert("Choose a proper weekly and daily frequency before saving")}function errorNeedProperFrequencyRange(){document.getElementById("others").value="",document.getElementById("others").placeholder="Number 1-1000",document.getElementById("others").className+=" error",alert("Please choose a frequency to be a number between\n1 and 1000")}function errorNeedToChooseProperImage(){alert("Please choose a proper image to upload. We support JPEG and PNG")}function errorNeedToChooseShorterTitle(){alert("Please choose a title 20 characters or less")}function getHabitById(a){for(var b,c=getAllHabits(),d=0;d<c.length;d++)if(b=c[d],a===b.id)return b}function getAllHabits(){var a=JSON.parse(localStorage.getItem("Habits"));return a||(a=[],localStorage.setItem("Habits",JSON.stringify(a))),a}function loadHtmlElements(a){if(document.getElementById("main-header").innerHTML="Edit A Habit",document.getElementById("title").value=a.get("title"),isInt(a.get("image")))onImageClick(document.getElementById("icon"+a.get("image")));else{var b="data:image/png;base64,"+a.get("image");addNewImageChild(b)}for(var c=document.getElementsByName("date"),d=0;d<c.length;d++){var e=c[d];a.get("weekFreq")[d]&&(e.checked=!0)}try{document.getElementsByName("day")[a.get("dailyFreq")-1].checked=!0}catch(f){document.getElementById("others").value=a.get("dailyFreq")}}function adjustFreqOnLoad(){var a=location.search.split("id=");a.length>=2?selectCheckBox(-1):(document.getElementById("df1").checked=!0,document.getElementById("defaultWeeklyFrequency").checked=!0)}Parse.initialize("lSrD6K2YbBIZKM7H8VMS43nY1ekjsEohi1RNY7Iu","c3iXu7MDpI5guDqlEgr93lan7z0BoajBWSjGOU2j"),Parse.User.current()||(location.href="login.html");var image=null;adjustFreqOnLoad();var idFromUrl=location.search.split("id=");if(idFromUrl.length<2)onImageClick(document.getElementById("icon1"));else{idFromUrl=idFromUrl[1];var Habit=Parse.Object.extend("Habit"),query=new Parse.Query(Habit);query.get(idFromUrl,{success:function(a){loadHtmlElements(a)},error:function(a,b){100!=b.code&&alert(b.message)}})}